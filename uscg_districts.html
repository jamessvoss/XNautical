<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>USCG Coast Guard Districts - XNautical</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a1628; color: #e0e6ed; }

  .header {
    background: linear-gradient(135deg, #0d2137 0%, #1a3a5c 100%);
    padding: 20px 30px;
    border-bottom: 2px solid #2a5a8a;
    display: flex; align-items: center; gap: 20px;
  }
  .header h1 { font-size: 22px; font-weight: 600; color: #ffffff; }
  .header .subtitle { font-size: 13px; color: #7a9ec4; margin-top: 2px; }

  .container { display: flex; height: calc(100vh - 72px); }

  #map { flex: 1; min-width: 0; }

  .sidebar {
    width: 380px; background: #0d1f35; border-left: 1px solid #1e3a5f;
    overflow-y: auto; padding: 16px;
  }

  .sidebar h2 { font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: #5a8ab5; margin-bottom: 12px; }

  .district-card {
    background: #132842; border: 1px solid #1e3a5f; border-radius: 8px;
    padding: 12px 14px; margin-bottom: 8px; cursor: pointer;
    transition: all 0.2s;
  }
  .district-card:hover { background: #1a3555; border-color: #2a6aaa; }
  .district-card.active { background: #1a3f65; border-color: #3a8ad5; }

  .district-card .top { display: flex; justify-content: space-between; align-items: center; }
  .district-card .id { font-size: 18px; font-weight: 700; color: #4a9aea; }
  .district-card .name { font-size: 13px; color: #c0d0e0; margin-top: 2px; }
  .district-card .region { font-size: 11px; color: #6a8aaa; margin-top: 4px; }

  .badge {
    display: inline-block; padding: 2px 8px; border-radius: 10px;
    font-size: 11px; font-weight: 600;
  }
  .badge.converted { background: #1a4a2a; color: #4ae04a; }
  .badge.source { background: #3a3a1a; color: #e0c040; }
  .badge.pending { background: #2a2a35; color: #8888aa; }

  .stats-row {
    display: flex; gap: 12px; margin-top: 6px; font-size: 11px; color: #6a8aaa;
  }
  .stats-row span { display: flex; align-items: center; gap: 4px; }

  .legend {
    margin-top: 16px; padding: 12px; background: #132842;
    border: 1px solid #1e3a5f; border-radius: 8px;
  }
  .legend h3 { font-size: 12px; color: #5a8ab5; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
  .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; font-size: 12px; color: #a0b0c0; }
  .legend-swatch { width: 14px; height: 14px; border-radius: 3px; border: 1px solid rgba(255,255,255,0.2); }

  .noaa-link {
    margin-top: 12px; text-align: center;
  }
  .noaa-link a {
    color: #4a9aea; font-size: 12px; text-decoration: none;
  }
  .noaa-link a:hover { text-decoration: underline; }

  .info-popup .leaflet-popup-content-wrapper {
    background: #132842; color: #e0e6ed; border: 1px solid #2a5a8a;
    border-radius: 8px;
  }
  .info-popup .leaflet-popup-tip { background: #132842; }
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>USCG Coast Guard Districts</h1>
    <div class="subtitle">ENC coverage areas for XNautical chart processing</div>
  </div>
</div>

<div class="container">
  <div id="map"></div>
  <div class="sidebar">
    <h2>Districts</h2>
    <div id="district-list"></div>

    <div class="legend">
      <h3>Status</h3>
      <div class="legend-item"><div class="legend-swatch" style="background:#4ae04a;"></div> Converted (charts ready)</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#e0c040;"></div> Source downloaded</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#8888aa;"></div> Pending</div>
    </div>

    <div class="legend" style="margin-top: 8px;">
      <h3>Map Colors</h3>
      <div class="legend-item"><div class="legend-swatch" style="background:#2ecc71;"></div> Converted</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#f1c40f;"></div> Source only</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#5dade2;"></div> Pending</div>
    </div>

    <div class="noaa-link">
      <a href="https://charts.noaa.gov/ENCs/ENCs.shtml" target="_blank">NOAA ENC Download Page &rarr;</a>
    </div>
  </div>
</div>

<script>
// =========================================================================
// District data
// =========================================================================
const districts = [
  {
    id: '01', name: '1st District', region: 'New England',
    hq: 'Boston, MA',
    states: 'ME, NH, MA, RI, CT, NY (north)',
    status: 'pending', charts: null, sizeMB: null,
    noaaZipMB: 97,
    center: [42.0, -70.0],
    bounds: [
      [40.5, -74.0], [40.5, -66.5], [45.5, -66.5], [47.5, -68.0],
      [47.5, -69.5], [45.0, -71.0], [41.5, -74.0], [40.5, -74.0]
    ],
    color: '#5dade2'
  },
  {
    id: '05', name: '5th District', region: 'Mid-Atlantic',
    hq: 'Portsmouth, VA',
    states: 'NJ, PA, DE, MD, DC, VA, NC, WV',
    status: 'pending', charts: null, sizeMB: null,
    noaaZipMB: 83,
    center: [37.5, -75.5],
    bounds: [
      [33.5, -80.0], [33.5, -74.5], [38.5, -74.0], [40.5, -74.0],
      [40.5, -75.5], [39.5, -76.5], [38.0, -78.5], [36.0, -80.0], [33.5, -80.0]
    ],
    color: '#5dade2'
  },
  {
    id: '07', name: '7th District', region: 'Southeast & Caribbean',
    hq: 'Miami, FL',
    states: 'SC, GA, FL (east), PR, USVI',
    status: 'pending', charts: null, sizeMB: null,
    noaaZipMB: 88,
    center: [27.0, -78.0],
    bounds: [
      [17.5, -68.0], [17.5, -64.0], [19.0, -64.0], [19.0, -65.5],
      [25.0, -79.5], [27.5, -80.0], [30.5, -80.5], [33.5, -78.0],
      [33.5, -80.0], [30.0, -81.5], [25.5, -80.5], [24.0, -81.5],
      [24.0, -83.0], [25.5, -82.5], [27.0, -83.0], [17.5, -68.0]
    ],
    color: '#5dade2'
  },
  {
    id: '08', name: '8th District', region: 'Gulf Coast',
    hq: 'New Orleans, LA',
    states: 'FL (panhandle), AL, MS, LA, TX, inland rivers',
    status: 'pending', charts: null, sizeMB: null,
    noaaZipMB: 96,
    center: [28.0, -91.0],
    bounds: [
      [25.5, -97.5], [25.5, -96.5], [28.0, -96.0], [29.5, -93.0],
      [29.0, -89.0], [30.0, -87.5], [30.5, -85.5], [27.0, -83.0],
      [25.5, -82.5], [24.5, -83.5], [26.0, -85.0], [27.0, -88.0],
      [27.0, -95.0], [25.5, -97.5]
    ],
    color: '#5dade2'
  },
  {
    id: '09', name: '9th District', region: 'Great Lakes',
    hq: 'Cleveland, OH',
    states: 'Great Lakes states (NY, PA, OH, MI, IN, IL, WI, MN)',
    status: 'pending', charts: null, sizeMB: null,
    noaaZipMB: 57,
    center: [44.0, -84.0],
    bounds: [
      [41.0, -92.5], [41.0, -76.0], [44.0, -76.0], [46.5, -84.0],
      [48.5, -88.0], [49.0, -95.0], [46.5, -92.5], [41.0, -92.5]
    ],
    color: '#5dade2'
  },
  {
    id: '11', name: '11th District', region: 'Southwest',
    hq: 'Alameda, CA',
    states: 'CA (Pt. Conception south), AZ, NV, UT',
    status: 'converted', charts: 228, sizeMB: 2180,
    noaaZipMB: 41,
    center: [33.5, -119.0],
    bounds: [
      [32.0, -120.5], [32.0, -117.0], [34.0, -117.5], [34.5, -119.0],
      [35.0, -120.8], [35.4, -121.5], [34.5, -121.5], [32.0, -120.5]
    ],
    color: '#2ecc71'
  },
  {
    id: '13', name: '13th District', region: 'Pacific Northwest',
    hq: 'Seattle, WA',
    states: 'CA (north of Pt. Conception), OR, WA, ID, MT',
    status: 'pending', charts: null, sizeMB: null,
    noaaZipMB: 55,
    center: [43.0, -124.5],
    bounds: [
      [35.4, -121.5], [35.0, -120.8], [36.5, -121.5], [37.5, -122.2],
      [38.5, -123.0], [40.5, -124.5], [42.0, -124.5], [46.0, -124.0],
      [48.5, -122.5], [49.0, -124.5], [48.5, -126.0], [46.0, -125.5],
      [42.0, -125.5], [38.5, -124.5], [35.4, -123.0], [35.4, -121.5]
    ],
    color: '#5dade2'
  },
  {
    id: '14', name: '14th District', region: 'Hawaii & Pacific',
    hq: 'Honolulu, HI',
    states: 'HI, Guam, American Samoa, Pacific Islands',
    status: 'pending', charts: null, sizeMB: null,
    noaaZipMB: 47,
    center: [21.0, -157.5],
    bounds: [
      [18.5, -161.0], [18.5, -154.5], [22.5, -154.5], [22.5, -161.0], [18.5, -161.0]
    ],
    color: '#5dade2'
  },
  {
    id: '17', name: '17th District', region: 'Alaska & Arctic',
    hq: 'Juneau, AK',
    states: 'AK',
    status: 'converted', charts: 1216, sizeMB: 8600,
    noaaZipMB: 207,
    center: [62.0, -153.0],
    bounds: [
      [51.0, -179.9], [51.0, -130.0], [55.0, -130.0], [60.0, -139.0],
      [69.0, -141.0], [71.5, -156.0], [71.5, -168.0], [65.0, -168.5],
      [54.0, -172.0], [51.0, -179.9]
    ],
    color: '#2ecc71'
  },
];

// =========================================================================
// Map
// =========================================================================
const map = L.map('map', {
  center: [38, -98],
  zoom: 4,
  zoomControl: true,
  attributionControl: true,
}).setMaxBounds([[-10, -200], [75, -50]]);

L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; OpenStreetMap &copy; CARTO',
  maxZoom: 12,
}).addTo(map);

const layers = {};

districts.forEach(d => {
  const fillColor = d.color;
  const polygon = L.polygon(d.bounds, {
    color: fillColor,
    weight: 2,
    opacity: 0.8,
    fillColor: fillColor,
    fillOpacity: 0.15,
    dashArray: d.status === 'pending' ? '6 4' : null,
  }).addTo(map);

  // Label
  const label = L.marker(d.center, {
    icon: L.divIcon({
      className: '',
      html: `<div style="
        background: rgba(10,22,40,0.85); border: 1px solid ${fillColor};
        border-radius: 6px; padding: 4px 10px; white-space: nowrap;
        font-family: sans-serif; text-align: center;
      ">
        <div style="font-size:16px; font-weight:700; color:${fillColor};">${d.id} CGD</div>
        <div style="font-size:10px; color:#a0b0c0;">${d.region}</div>
      </div>`,
      iconSize: [0, 0],
      iconAnchor: [50, 20],
    })
  }).addTo(map);

  // Popup
  const chartInfo = d.charts
    ? `<div style="margin-top:6px;"><strong>${d.charts}</strong> charts &middot; <strong>${(d.sizeMB/1024).toFixed(1)}</strong> GB</div>`
    : `<div style="margin-top:6px; color:#8888aa;">Not yet processed</div>`;

  const statusBadge = d.status === 'converted'
    ? '<span style="color:#4ae04a;">&#9679;</span> Converted'
    : d.status === 'source'
    ? '<span style="color:#e0c040;">&#9679;</span> Source downloaded'
    : '<span style="color:#8888aa;">&#9679;</span> Pending';

  polygon.bindPopup(`
    <div style="font-family:sans-serif; min-width:180px;">
      <div style="font-size:16px; font-weight:700; color:#4a9aea;">${d.id} CGD - ${d.name}</div>
      <div style="font-size:12px; color:#a0b0c0; margin-top:2px;">${d.region}</div>
      <div style="font-size:12px; margin-top:6px;">HQ: ${d.hq}</div>
      <div style="font-size:12px;">States: ${d.states}</div>
      <div style="font-size:12px; margin-top:6px;">${statusBadge}</div>
      ${chartInfo}
      <div style="font-size:11px; color:#6a8aaa; margin-top:4px;">NOAA ZIP: ${d.noaaZipMB} MB</div>
    </div>
  `, { className: 'info-popup', maxWidth: 280 });

  layers[d.id] = { polygon, label };
});

// =========================================================================
// Sidebar
// =========================================================================
const listEl = document.getElementById('district-list');

districts.forEach(d => {
  const statusClass = d.status === 'converted' ? 'converted' : d.status === 'source' ? 'source' : 'pending';
  const statusLabel = d.status === 'converted' ? 'Converted' : d.status === 'source' ? 'Source' : 'Pending';

  const chartStats = d.charts
    ? `<span>${d.charts} charts</span><span>${(d.sizeMB/1024).toFixed(1)} GB</span>`
    : `<span>NOAA ZIP: ${d.noaaZipMB} MB</span>`;

  const card = document.createElement('div');
  card.className = 'district-card';
  card.innerHTML = `
    <div class="top">
      <div>
        <div class="id">${d.id} CGD</div>
        <div class="name">${d.name} &mdash; ${d.region}</div>
      </div>
      <span class="badge ${statusClass}">${statusLabel}</span>
    </div>
    <div class="region">HQ: ${d.hq} &middot; ${d.states}</div>
    <div class="stats-row">${chartStats}</div>
  `;

  card.addEventListener('click', () => {
    document.querySelectorAll('.district-card').forEach(c => c.classList.remove('active'));
    card.classList.add('active');
    map.fitBounds(layers[d.id].polygon.getBounds(), { padding: [40, 40], maxZoom: 7 });
    layers[d.id].polygon.openPopup();
  });

  listEl.appendChild(card);
});
</script>
</body>
</html>
